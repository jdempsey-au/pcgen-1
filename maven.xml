<project xmlns:maven="jelly:maven" xmlns:j="jelly:core"
    xmlns:ant="jelly:ant" xmlns:u="jelly:util">
	<goal name="generate-jars">
		<ant:ant dir="${basedir}" antfile="build.xml" target="build-plugins">
			<property name="build.classes.dir" value="${maven.build.dest}"/>
		</ant:ant>
	</goal>
    <preGoal name="java:compile">
        <attainGoal name="javacc:javacc-generate"/>
        <!-- Kludge around a typo in the JavaCC  -->
        <ant:path id="maven.javacc.compile.src.set"
            location="${basedir}/target/generated-src"/>
        <maven:addPath id="maven.compile.src.set"
            refid="maven.javacc.compile.src.set"/>
    </preGoal>
    <postGoal name="java:compile">
		<attainGoal name="generate-jars" />
    </postGoal>
    <preGoal name="maven-javadoc-plugin:report">
    	<attainGoal name="javacc:javacc-generate"/>
    </preGoal>
    
    
    <goal name="pcgen:package-clean">
    	<ant:mkdir dir="${basedir}/target/distributions" />
    	<ant:delete>
    		<fileset dir="${basedir}/target/distributions" includes="*.zip, *.tgz"/>
    	</ant:delete>
    </goal>
    
    <goal name="pcgen:package" prereqs="pcgen:package-clean">
    	<ant:mkdir dir="${basedir}/target/distributions" />
    	
    	<ant:zip basedir="${basedir}" destfile="target/distributions/pcgen-all.zip" 
    		includes="pcgen.jar, pcgen.bat, pcgen.sh, pcgen_low_mem.bat, plugins/**, data/**, outputsheets/**, docs/**, system/**, lib/**" 
    		excludes="lib/emma/**, lib/test/**" />
    	<ant:zip basedir="${basedir}" destfile="target/distributions/pcgen-code.zip" 
    		includes="pcgen.jar, pcgen.bat, pcgen.sh, pcgen_low_mem.bat, plugins/**" />
    	<ant:zip basedir="${basedir}" destfile="target/distributions/pcgen-content.zip" 
    		includes="data/**, outputsheets/**, docs/**, system/**" />
    	<ant:zip basedir="${basedir}" destfile="target/distributions/pcgen-libraries.zip" 
    		includes="lib/**" 
    		excludes="lib/emma/**, lib/test/**"/>
    		
    	<ant:tar compression="gzip" longfile="gnu" 
    		destfile="target/distributions/pcgen-all.tgz">
		  <tarfileset dir="${basedir}" mode="755">
		    <include name="pcgen.sh"/>
		  </tarfileset>
		  <tarfileset dir="${basedir}" >
		    <include name="pcgen.jar"/>
		    <include name="pcgen.bat"/>
		    <include name="pcgen_low_mem.bat"/>
		    <include name="plugins/**"/>
		    <include name="data/**"/>
		    <include name="outputsheets/**"/>
		    <include name="docs/**"/>
		    <include name="system/**"/>
		    <include name="lib/**"/>
		  </tarfileset>
      	</ant:tar>
    		 
    	<ant:tar basedir="${basedir}" compression="gzip"  longfile="gnu"
    		destfile="target/distributions/pcgen-code.tgz" 
    		includes="pcgen.jar, pcgen.bat, pcgen.sh, pcgen_low_mem.bat, plugins/**" />
    	<ant:tar basedir="${basedir}" compression="gzip" longfile="gnu" 
    		destfile="target/distributions/pcgen-content.tgz" 
    		includes="data/**, outputsheets/**, docs/**, system/**" />
    	<ant:tar basedir="${basedir}" compression="gzip" longfile="gnu" 
    		destfile="target/distributions/pcgen-libraries.tgz" 
    		includes="lib/**" 
    		excludes="lib/emma/**, lib/test/**"/>
    </goal>
    
</project>    
